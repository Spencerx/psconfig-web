<ng-include src="'t/sidebar.html'"></ng-include>
<div class="sca-sidebar-page">
    <div class="subbar">
        <div style="padding-left: 20px; margin-bottom: 10px;">
            <h2>Mesh Configs</h2>
            <p class="help-block">Showing registred mesh configs</p>
            <br>
            <div class="btn-group pull-right" style="left: -20px;top: -5px;">
                <button class="btn btn-xs btn-default dropdown-toggle" 
                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Type <span class="caret"></span>
                </button>
                <ul class="dropdown-menu">
                <li><a href>All</a></li>
                <li role="separator" class="divider"></li>
                <li><a href>Latency</a></li>
                <li><a href>Bandwidth</a></li>
                <li><a href>Traceroute</a></li>
                <li><a href>Pinger</a></li>
                </ul>
            </div>
            <span class="text-muted">{{configs.length}} configs</span>
        </div>
        <hr style="margin: 0px;">

        <div class="subbar-list" style="bottom: 160px;">
            <p class="alert alert-info" ng-if="configs.length == 0">Please register a mesh config.</p>
            <div class="subbar-list-item" 
                ng-repeat="config in configs" 
                ng-class="{active: selected == config}"
                ng-click="select(config)">
                <time class="help-block pull-right">{{config.create_date|date}}</time>
                <div class="list-header">
                    <small>
                        <span class="label label-default">/{{config.url}}</span> {{config.name}}
                        <i ng-if="!config._canedit" class="fa fa-lock text-muted"></i>
                    </small>
                </div>
            </div>
            <div class="list-addbutton" ng-click="add()" title="Add new config" style="bottom: 180px">
                <i class="fa fa-plus-circle" aria-hidden="true"></i> 
            </div>
        </div>

        <div class="autoconfig">
            <h3 style="margin-top: 15px;">Auto Mesh Config</h3>
            <p class="help-block">Enter hostname of perfSONAR toolkit instance to generate a mesh config URL containing tests for that instance as test endpoints.</p>
            <ui-select 
                ng-model="autoconf_select" on-select="autoconf($item)">
                <ui-select-match placeholder="Enter hostname">
                    <div style="padding-top: 2px; font-size: 12px">
                        <b>{{$select.selected.sitename}}</b> ({{$select.selected.hostname}})
                    </div>
                </ui-select-match>
                <ui-select-choices 
                    position="auto"
                    repeat="host.uuid as host in hosts | filter: $select.search">
                    <b>{{host.sitename}}</b> (<span ng-if="host.hostname">{{host.hostname}}</span><span ng-if="!host.hostname && host.ip">{{host.ip}}</span>)
                </ui-select-choices>
            </ui-select>
        </div>
    </div><!--subbar-->

    <div class="subbar-content">
        <p class="alert alert-info" ng-if="!selected">Please select config</p>
        <form name="form" class="form-horizontal" ng-submit="submit()" ng-show="selected" confirm-on-exit>
            <div class="fixed-top">
                <h2>
                    <i class="fa fa-trash-o clickable" aria-hidden="true" ng-if="selected._id && selected._canedit"
                        ng-confirm-click="Are you sure you want to remove this test spec?"
                        confirmed-click="remove()"></i>&nbsp;&nbsp;&nbsp;
                    <!--
                    <i class="fa fa-info-circle" aria-hidden="true"></i>&nbsp;&nbsp;&nbsp;
                    <i class="fa fa-star-o" aria-hidden="true"></i>&nbsp;&nbsp;&nbsp;
                    <i class="fa fa-share-alt" aria-hidden="true"></i>&nbsp;&nbsp;&nbsp;
                    -->
                    <div class="pull-right" style="padding-right: 20px;">
                         <div ng-if="form.$dirty && selected._canedit" class="display: inline-block;">
                            <button type="submit" class="btn btn-primary" ng-if="selected._id">Update</button>
                            <button type="submit" class="btn btn-primary" ng-if="!selected._id">Create</button>
                            <button type="button" class="btn" ng-click="cancel()">Cancel</button>
                        </div>
                    </div>
                </h2>
                <br clear="right">
                <div class="form-group">
                    <div class="margin30">
                        <label class="col-sm-2 control-label">MeshConfig URL</label>
                        <div class="col-sm-10">
                            <div class="input-group">
                                <span class="input-group-addon"><small>{{appconf.pub_url}}</small></span>
                                <input type="text" name="url" class="form-control" id="url" 
                                    ng-model="selected.url" 
                                    placeholder="Enter path to expose this config" 
                                    ng-disabled="!selected._canedit" required>
                                <span class="input-group-btn" ng-if="selected._id">
                                    <button class="btn btn-primary" type="button" 
                                        ng-disabled="form.$dirty"
                                        ng-click="relocate(appconf.pub_url+'config/'+selected.url, true)">
                                        <i class="fa fa-external-link" aria-hidden="true"></i> Open MeshConfig
                                    </button>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div class="margin30">
                        <label for="name" class="col-sm-2 control-label"><strong>Name *</strong></label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="name" ng-model="selected.name" 
                                ng-disabled="!selected._canedit"
                                placeholder="Name for this config" required>
                        </div>
                    </div>
                </div>
                <hr style="margin-bottom: 0px;">
            </div><!--fixed-top-->

            <div style="padding-top: 200px" class="margin30">
                <div class="form-group">
                    <label class="col-sm-2 control-label">Description</label>
                    <div class="col-sm-10">
                        <textarea class="form-control" id="desc" ng-model="selected.desc" ng-disabled="!selected._canedit"></textarea>
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-sm-2 control-label">Admins</label>
                    <div class="col-sm-10">
                        <ui-select multiple ng-model="selected.admins" ng-disabled="!selected._canedit">
                            <ui-select-match placeholder="Select admins who can update this mesh config?">
                                <img gravatar-src="$item.email" gravatar-size="17"/>
                                <b>{{$item.fullname}}</b> <span class="email">&lt;{{$item.email}}&gt;</span>
                            </ui-select-match>
                            <ui-select-choices repeat="user.id as user in users | propsFilter: {fullname: $select.search, email: $select.search}">
                              <img gravatar-src="user.email" gravatar-size="17"/>
                              <b>{{user.fullname}}</b> <small>&lt;{{user.email}}&gt;</small>
                            </ui-select-choices>
                        </ui-select>
                        <p class="help-block">Users who can update this configuration</p>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">Tests</label>
                    <div class="col-sm-10">
                        <ul class="list-group" ng-if="selected.tests.length > 0">
                            <li class="list-group-item slide-down" ng-repeat="test in selected.tests" ng-class="{disabled: !test.enabled}">
                                <ng-include src="'t/testeditor.html'"></ng-include>
                            </li>
                        </ul>
                        <button type="button" ng-click="addtest()" ng-show="selected._canedit" class="btn btn-sm">Add New Test</button>
                    </div>
                </div>

                <br>
                <br>
                <h3>Debug</h3>
                <pre>{{selected|json}}</pre>
            </div>
        </form>
        <!--
        <ul class="list-group">
        <li class="list-group-item" style="background-color: #fafafa">
            <br>
            <br>
        </li>
        <li class="list-group-item" ng-repeat="config in configs | orderBy:'id' ">
            <div class="row">
                <div class="col-lg-8">
                    <h4>
                        <small>{{config.id}}</small> 
                        {{config.desc}}
                        <small><a href="{{appconf.pub_url}}/config/{{config.url}}" target="_blank">/{{config.url}}</a></small>
                    </h4>
                    <mc-tests tests="config.Tests" servicetypes="serverconf.service_types"></mc-tests>
                </div>
                <div class="col-md-4">
                    <h5>Admins<small> (who can edit)</small></h5>
                    <mc-admins admins="config.admins"></mc-admins>
                </div>
            </div>
            <div class="pull-right edit_button" ng-if="config.canedit">
                <button type="button" ng-click="edit(config)" class="btn btn-xs pull-right"><i class="fa fa-pencil-square-o"></i></button>
            </div>
            <div class="pull-right edit_button" ng-if="!config.canedit">
                <button type="button" ng-click="edit(config)" class="btn btn-xs pull-right"><i class="fa fa-eye"></i></button>
            </div>
        </li>
        </ul>
        <button type="button" ng-click="addconfig()" ng-if="cancreate" class="btn btn-sm">Add New</button>
        -->
    </div><!--subbar-content-->
</div><!--sca-sidebar-page-->

